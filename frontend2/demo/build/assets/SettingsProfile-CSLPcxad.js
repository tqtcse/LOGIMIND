import{r as h,j as e,g as v}from"./index-DtwSxASm.js";import{B as S}from"./Button-i5g00eBi.js";import{I as f}from"./Input-BNk8Jtou.js";import{u as X,F as _,C as g,a as y}from"./index.esm-Cn3F_1Fv.js";import{a as J}from"./AccontsService-BZEQNtVZ.js";import{s as K}from"./sleep-BvINh1mj.js";import{t as W,z as n}from"./index-DNuGD4fr.js";import{C as I}from"./index-BjgA-DNM.js";import{L as G,y as j}from"./index-DPBfSoHl.js";/* empty css                      */import{U as Q}from"./Upload-CbTYts6L.js";import{A as V}from"./index-o-oCqQIP.js";import{c as Y}from"./index-CHU72eNV.js";import{T as Z}from"./index-DYfuKO4A.js";import{u as ee}from"./index-B_V5_N-x.js";import"./classNames-ePRZs5sB.js";import"./context-DPxwjVT1.js";import"./isNil-BVBaoyN1.js";import"./proxy-CApU-jHi.js";import"./cloneDeep-BSOSHLnM.js";import"./_getPrototype-m6aH4G2r.js";import"./index-BnPKvy3X.js";import"./CloseButton-C-zx-kDW.js";import"./StatusIcon-C3ptiLRj.js";import"./Tooltip-rsOlGEfv.js";import"./index-_Kd8pdCn.js";import"./floating-ui.dom-DBm5Idhu.js";import"./index-BwWjUWmm.js";const ae="FMSdarBAdtoan",b="http://103.97.127.14:3000",te=n.object({firstName:n.string().min(1,{message:"First name required"}),lastName:n.string().min(1,{message:"Last name required"}),email:n.string().min(1,{message:"Email required"}).email({message:"Invalid email"}),dialCode:n.string().min(1,{message:"Please select your country code"}),phoneNumber:n.string().min(1,{message:"Please input your mobile number"}),country:n.string().min(1,{message:"Please select a country"}),address:n.string().min(1,{message:"Addrress required"}),postcode:n.string().min(1,{message:"Postcode required"}),city:n.string().min(1,{message:"City required"}),img:n.string()}),Fe=()=>{var N,w,A,U,L;const{trigger:q,data:se,isMutating:re}=ee("/api/delete/avatar",(t,{arg:a})=>J(a)),F=t=>{let a=!0;const o=["image/jpeg","image/png"];if(t)for(const r of t)o.includes(r.type)||(a="Please upload a .jpeg or .png file!");return a},{handleSubmit:$,reset:oe,formState:{errors:i,isSubmitting:z},control:d}=X({resolver:W(te)}),[m,D]=h.useState(void 0),[M,P]=h.useState(null);h.useRef(null);const[l,u]=h.useState({fullname:"",address:"",company:"",username:"",email:""}),R=async()=>{var t,a,o,r,c;try{const s=(t=document.querySelector("#fullname"))==null?void 0:t.getAttribute("value"),p=(a=document.querySelector("#address"))==null?void 0:a.getAttribute("value"),x=(o=document.querySelector("#company"))==null?void 0:o.getAttribute("value"),T=(r=document.querySelector("#username"))==null?void 0:r.getAttribute("value"),B=(c=document.querySelector("#email"))==null?void 0:c.getAttribute("value"),C=localStorage.getItem("token");(await v.post(`${b}/user/update-user-infor`,{email:B,name:s,username:T,address:p,company:x},{headers:{Authorization:`Bearer ${C}`}})).status===200&&(j.success("Lưu thành công!",{autoClose:1e3}),setTimeout(()=>{window.location.reload()},1e3))}catch(s){console.log(s)}};h.useEffect(()=>{(async()=>{try{const r=localStorage.getItem("token");var a=localStorage.getItem("email"),o="";a&&(a=I.AES.decrypt(a,ae).toString(I.enc.Utf8),D(a),m&&(o=m.replace(".com","")));const c=o,s=await v.post(`${b}/user/get-user-infor`,{email:a},{headers:{Authorization:`Bearer ${r}`}}),p=s.data.address,x=s.data.company,T=s.data.fullname,B=s.data.username;u({fullname:s.data.fullname||"",address:s.data.address||"",company:s.data.company||"",username:s.data.username||"",email:s.data.email||""});const C=await v.get(`${b}/image/images/${c}`,{headers:{Authorization:`Beaturer ${r}`},responseType:"blob"}),k=URL.createObjectURL(C.data);P(k)}catch(r){console.log(r)}})()},[m]);const E=async t=>{await K(500)},H=async(t,a)=>{try{var o="";m&&(o=m.replace(".com",""));const r=new File([t],`${o}.${t.name.split(".").pop()}`,{type:t.type}),c=new FormData;c.append("file",r);const s=localStorage.getItem("token"),p=await v.post(`${b}/image/imgUpload`,c,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"multipart/form-data"}});if(p.status===200){const x=p.data.url;a.onChange(x),j.success("Lưu thành công!",{autoClose:1e3}),setTimeout(()=>{window.location.reload()},1e3)}}catch(r){console.error("Lỗi khi tải ảnh lên:",r),j.error("Tải ảnh thất bại!")}},O=async()=>{try{const a=localStorage.getItem("token");var t="";m&&(t=m.replace(".com",""),await q(t)&&(j.success("Xóa thành công!",{autoClose:1e3}),setTimeout(()=>{window.location.reload()},1e3)))}catch(a){console.log(a),console.error("Lỗi khi xoá ảnh :",a)}};return e.jsxs(e.Fragment,{children:[e.jsx(G,{}),e.jsx("h4",{className:"mb-6",children:"Thông tin cá nhân"}),e.jsxs(_,{onSubmit:$(E),children:[e.jsx("div",{className:"mb-8",children:e.jsx(g,{name:"img",control:d,render:({field:t})=>e.jsxs("div",{id:"Avatar",className:"flex items-center gap-4",children:[e.jsx(V,{id:"avatar",size:90,className:"border-4 border-white bg-gray-100 text-gray-300 shadow-lg",icon:e.jsx(Y,{}),src:M||t.value}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{showList:!1,uploadLimit:1,beforeUpload:F,onChange:a=>{a.length>0&&(H(a[0],t),t.onChange(URL.createObjectURL(a[0])))},children:e.jsx(S,{variant:"solid",size:"sm",type:"button",icon:e.jsx(Z,{}),children:"Tải ảnh"})}),e.jsx(S,{size:"sm",type:"button",onClick:O,children:"Xóa ảnh"})]})]})})}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(y,{label:"Họ và tên",invalid:!!i.firstName,errorMessage:(N=i.firstName)==null?void 0:N.message,children:e.jsx(g,{name:"firstName",control:d,render:({field:t})=>e.jsx(f,{type:"text",autoComplete:"off",placeholder:"Họ và tên",id:"fullname",value:l.fullname,onChange:a=>u({...l,fullname:a.target.value})})})}),e.jsx(y,{label:"Tên người dùng",invalid:!!i.lastName,errorMessage:(w=i.lastName)==null?void 0:w.message,children:e.jsx(g,{name:"lastName",control:d,render:({field:t})=>e.jsx(f,{type:"text",autoComplete:"off",placeholder:"Tên người dùng",id:"username",value:l.username,onChange:a=>u({...l,username:a.target.value})})})})]}),e.jsx(y,{label:"Email",invalid:!!i.email,errorMessage:(A=i.email)==null?void 0:A.message,children:e.jsx(g,{name:"email",control:d,render:({field:t})=>e.jsx(f,{type:"email",autoComplete:"off",placeholder:"Email",id:"email",value:l.email,onChange:a=>u({...l,email:a.target.value}),disabled:!0})})}),e.jsx("div",{className:"flex items-end gap-4 w-full mb-6"}),e.jsx("h4",{className:"mb-6",children:"Thông tin địa chỉ"}),e.jsx(y,{label:"Nơi ở",invalid:!!i.address,errorMessage:(U=i.address)==null?void 0:U.message,children:e.jsx(g,{name:"address",control:d,render:({field:t})=>e.jsx(f,{type:"text",autoComplete:"off",placeholder:"Nơi ở hiện tại",id:"address",value:l.address,onChange:a=>u({...l,address:a.target.value})})})}),e.jsx(y,{label:"Công ty",invalid:!!i.city,errorMessage:(L=i.city)==null?void 0:L.message,children:e.jsx(g,{name:"city",control:d,render:({field:t})=>e.jsx(f,{type:"text",autoComplete:"off",placeholder:"Công ty",id:"company",value:l.company,onChange:a=>u({...l,company:a.target.value})})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(S,{variant:"solid",type:"button",loading:z,onClick:R,children:"Lưu"})})]})]})};export{Fe as default};
